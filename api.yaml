swagger: "2.0"
info:
  description: "This is an API for a [SalamLab](http://salamlab.pl) workflow management system."
  version: "0.1.0"
  title: "SalamLab API"
  termsOfService: "http://salamlab.pl/terms/"
  contact:
    email: "contact@salamlab.pl"
  license:
    name: "Apache 2.0"
    url: "http://www.apache.org/licenses/LICENSE-2.0.html"
host: "salamlab-cloudrun-i4omjkfpsa-lm.a.run.app"
tags:
  - name: "host"
    description: "Information about the hosts"
  - name: "accommodation"
    description: "Information about the accommodation units"
  - name: "guest"
    description: "Information about the guests"
  - name: "teammember"
    description: "Information about the team members"
schemes:
  - "https"
paths:
  /host:
    post:
      tags:
        - "host"
      summary: "Add new host"
      description: ""
      operationId: "add_host"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/add_host
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Host object that needs to be added to the database"
          required: true
          schema:
            $ref: "#/definitions/HostCreate"
      responses:
        "405":
          description: "Invalid input"
        "201":
          description: "Created"
      security:
        - salamlab_auth:
            - "write:hosts"
            - "read:hosts"
  /host/{hostId}:
    get:
      tags:
        - "host"
      summary: "Find host by ID"
      description: "Returns a single host"
      operationId: "get_host_by_id"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/get_host_by_id
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "hostId"
          in: "path"
          description: "ID of host to return"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/Host"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Host not found"
      security:
        - api_key: []
    post:
      tags:
        - "host"
      summary: "Updates a host in the database"
      description: ""
      operationId: "update_host"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/update_host
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - name: "hostId"
          in: "path"
          description: "ID of host that needs to be updated"
          required: true
          type: "string"
          format: "uuid"
        - in: "body"
          name: "body"
          description: "Host information that needs to be updated in the database"
          required: true
          schema:
            $ref: "#/definitions/HostUpdate"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/Host"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Host not found"
        "405":
          description: "Invalid input"
      security:
        - salamlab_auth:
            - "write:hosts"
            - "read:hosts"
    delete:
      tags:
        - "host"
      summary: "Deletes a host"
      description: ""
      operationId: "delete_host"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/delete_host
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "api_key"
          in: "header"
          required: false
          type: "string"
        - name: "hostId"
          in: "path"
          description: "Host id to delete"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Pet not found"
      security:
        - salamlab_auth:
            - "write:hosts"
            - "read:hosts"
  /accommodation:
    post:
      tags:
        - "accommodation"
      summary: "Add new accommodation unit"
      description: ""
      operationId: "add_accommodation"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/add_accommodation
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Accommodation Unit object that needs to be added to the database"
          required: true
          schema:
            $ref: "#/definitions/AccommodationUnitCreate"
      responses:
        "405":
          description: "Invalid input"
        "201":
          description: "Created"
      security:
        - salamlab_auth:
            - "write:accommodations"
            - "read:accommodations"
  /accommodation/findByNeeds:
    get:
      tags:
        - "accommodation"
      summary: "Finds accommodation by needs"
      description: ""
      operationId: "find_accommodation_by_needs"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/find_accommodation_by_needs
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Description of needs"
          required: true
          schema:
            $ref: "#/definitions/AccommodationNeeds"
      responses:
        "200":
          description: "successful operation"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/AccommodationUnit"
        "400":
          description: "Invalid status value"
      security:
        - salamlab_auth:
            - "read:hosts"
  /accommodation/{accommodationId}:
    get:
      tags:
        - "accommodation"
      summary: "Find accommodation unit by ID"
      description: "Returns a single accommodation unit"
      operationId: "get_accommodation_by_id"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/get_accommodation_by_id
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "accommodationId"
          in: "path"
          description: "ID of accommodation to return"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/AccommodationUnit"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Accommodation Unit not found"
      security:
        - api_key: []
    post:
      tags:
        - "accommodation"
      summary: "Updates an accommodation unit"
      description: ""
      operationId: "update_accommodation"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/update_accommodation
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - name: "accommodationId"
          in: "path"
          description: "ID of host that needs to be updated"
          required: true
          type: "string"
          format: "uuid"
        - in: "body"
          name: "body"
          description: "Host information that needs to be updated in the database"
          required: true
          schema:
            $ref: "#/definitions/AccommodationUnitUpdate"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/AccommodationUnit"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Accommodation Unit not found"
        "405":
          description: "Invalid input"
      security:
        - salamlab_auth:
            - "write:accommodations"
            - "read:accommodations"
    delete:
      tags:
        - "accommodation"
      summary: "Deletes an Accommodation Unit"
      description: ""
      operationId: "delete_accommodation"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/delete_accommodation
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "api_key"
          in: "header"
          required: false
          type: "string"
        - name: "accommodationId"
          in: "path"
          description: "Accommodation Unit id to delete"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Pet not found"
      security:
        - salamlab_auth:
            - "write:accommodations"
            - "read:accommodations"
  /guest:
    post:
      tags:
        - "guest"
      summary: "Add new guest"
      description: ""
      operationId: "add_guest"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/add_guest
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Guest object that needs to be added to the database"
          required: true
          schema:
            $ref: "#/definitions/GuestCreate"
      responses:
        "405":
          description: "Invalid input"
        "201":
          description: "Created"
      security:
        - salamlab_auth:
            - "write:guests"
            - "read:guests"
  /guest/{guestId}:
    get:
      tags:
        - "guest"
      summary: "Find guest by ID"
      description: "Returns a single guest"
      operationId: "get_guest_by_id"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/get_guest_by_id
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "guestId"
          in: "path"
          description: "ID of guest to return"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/Guest"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Guest not found"
      security:
        - api_key: []
    post:
      tags:
        - "guest"
      summary: "Updates a guest in the database"
      description: ""
      operationId: "update_guest"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/update_guest
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - name: "guestId"
          in: "path"
          description: "ID of guest that needs to be updated"
          required: true
          type: "string"
          format: "uuid"
        - in: "body"
          name: "body"
          description: "Guest information that needs to be updated in the database"
          required: true
          schema:
            $ref: "#/definitions/GuestUpdate"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/Guest"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Guest not found"
        "405":
          description: "Invalid input"
      security:
        - salamlab_auth:
            - "write:guests"
            - "read:guests"
    delete:
      tags:
        - "guest"
      summary: "Deletes a guest"
      description: ""
      operationId: "delete_guest"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/delete_guest
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "api_key"
          in: "header"
          required: false
          type: "string"
        - name: "guestId"
          in: "path"
          description: "Guest id to delete"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Pet not found"
      security:
        - salamlab_auth:
            - "write:guests"
            - "read:guests"
  /teammember:
    post:
      tags:
        - "teammember"
      summary: "Add new teammember"
      description: ""
      operationId: "add_teammember"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/add_teammember
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Teammember object that needs to be added to the database"
          required: true
          schema:
            $ref: "#/definitions/TeamMemberCreate"
      responses:
        "405":
          description: "Invalid input"
        "201":
          description: "Created"
      security:
        - salamlab_auth:
            - "write:teammembers"
            - "read:teammembers"
  /teammember/{teammemberId}:
    get:
      tags:
        - "teammember"
      summary: "Find teammember by ID"
      description: "Returns a single teammember"
      operationId: "get_teammember_by_id"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/get_teammember_by_id
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "teammemberId"
          in: "path"
          description: "ID of teammember to return"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/TeamMember"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Teammember not found"
      security:
        - api_key: []
    post:
      tags:
        - "teammember"
      summary: "Updates a teammember in the database"
      description: ""
      operationId: "update_teammember"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/update_teammember
        protocol: h2
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - name: "teammemberId"
          in: "path"
          description: "ID of teammember that needs to be updated"
          required: true
          type: "string"
          format: "uuid"
        - in: "body"
          name: "body"
          description: "Teammember information that needs to be updated in the database"
          required: true
          schema:
            $ref: "#/definitions/TeamMemberUpdate"
      responses:
        "200":
          description: "successful operation"
          schema:
            $ref: "#/definitions/TeamMember"
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Teammember not found"
        "405":
          description: "Invalid input"
      security:
        - salamlab_auth:
            - "write:teammembers"
            - "read:teammembers"
    delete:
      tags:
        - "teammember"
      summary: "Deletes a teammember"
      description: ""
      operationId: "delete_teammember"
      x-google-backend:
        address: https://europe-central2-salamlab-apartments.cloudfunctions.net/delete_teammember
        protocol: h2
      produces:
        - "application/json"
      parameters:
        - name: "api_key"
          in: "header"
          required: false
          type: "string"
        - name: "teammemberId"
          in: "path"
          description: "Teammember id to delete"
          required: true
          type: "string"
          format: "uuid"
      responses:
        "400":
          description: "Invalid ID supplied"
        "404":
          description: "Pet not found"
      security:
        - salamlab_auth:
            - "write:teammembers"
            - "read:teammembers"
securityDefinitions:
  salamlab_auth:
    type: "oauth2"
    authorizationUrl: "http://petstore.swagger.io/oauth/dialog"
    flow: "implicit"
    scopes:
      write:hosts: "modify host information"
      read:hosts: "read host information"
      write:accommodations: "modify accommodation information"
      read:accommodations: "read accommodation information"
      write:guests: "modify guest information"
      read:guests: "read guest information"
      write:teammembers: "modify teammembers information"
      read:teammembers: "read teammembers information"
  api_key:
    type: "apiKey"
    name: "api_key"
    in: "header"

definitions:
  Time:
    type: "string"
    pattern: '^\d{1,2}(:\d{2})?([AaPp][mM])?$'
    description: >
      Time can be given in 12h or 24h format.

  PhoneNumber:
    type: "string"
    pattern: '^(\+\d{1,2} ?)?\d{3}[- \.]?\d{3}[- \.]?\d{3}$'
    description: >
      Phone number, can include optional national prefix `+48`. Triplets may be separated by
      `-`, ` ` or `.`.

  Language:
    type: "string"
    enum:
      - "En"
      - "Pl"
      - "Uk"
      - "Ru"
    description: "2 letter ISO-639-1 compliant code"

  HostCreate:
    type: "object"
    required:
      - "fullName"
      - "email"
      - "phoneNumber"
    properties:
      fullName:
        type: "string"
        example: "Cecylia Łukaszyk"
      email:
        type: "string"
        format: "email"
      phoneNumber:
        $ref: "#/definitions/PhoneNumber"
      callAfter:
        $ref: "#/definitions/Time"
      callBefore:
        $ref: "#/definitions/Time"
      comments:
        type: "string"
        description: "Free text comments from Host"
      languagesSpoken:
        type: "array"
        items:
          $ref: "#/definitions/Language"

  HostUpdate:
    allOf:
      - $ref: "#/definitions/HostCreate"
      - type: "object"
        properties:
          status:
            type: "string"
            description: "Verification status of the Host"
            enum:
              - "created"
              - "verified"
              - "rejected"

  Host:
    allOf:
      - $ref: "#/definitions/HostUpdate"
      - type: "object"
        properties:
          id:
            type: "string"
            format: "uuid"
          createdAt:
            type: "string"
            format: "date-time"
          updatedAt:
            type: "string"
            format: "date-time"

  Voivodeship:
    type: "string"
    enum:
      - "DOLNOŚLĄSKIE"
      - "KUJAWSKO-POMORSKIE"
      - "LUBELSKIE"
      - "LUBUSKIE"
      - "ŁÓDZKIE"
      - "MAŁOPOLSKIE"
      - "MAZOWIECKIE"
      - "OPOLSKIE"
      - "PODKARPACKIE"
      - "PODLASKIE"
      - "POMORSKIE"
      - "ŚLĄSKIE"
      - "ŚWIĘTOKRZYSKIE"
      - "WARMIŃSKO-MAZURSKIE"
      - "WIELKOPOLSKIE"
      - "ZACHODNIOPOMORSKIE"

  AccommodationUnitCreate:
    type: "object"
    required:
      - "hostId"
      - "city"
      - "zip"
      - "voivodeship"
      - "addressLine"
      - "vacanciesTotal"
    properties:
      hostId:
        type: "string"
        format: "uuid"
      city:
        type: "string"
        description: "City name"
      zip:
        type: "string"
        pattern: '^\d{2}-\d{3}'
        description: "Zip code"
      voivodeship:
        $ref: "#/definitions/Voivodeship"
      addressLine:
        type: "string"
      vacanciesTotal:
        type: "integer"
      havePets:
        type: "boolean"
      acceptsPets:
        type: "boolean"
      comments:
        type: "string"

  AccommodationUnitUpdate:
    allOf:
      - $ref: "#/definitions/AccommodationUnitCreate"
      - type: "object"
        properties:
          vacanciesFree:
            type: "integer"
          status:
            type: "string"
            description: "Verification status of the Host"
            enum:
              - "created"
              - "verified"
              - "rejected"

  AccommodationUnit:
    allOf:
      - $ref: "#/definitions/AccommodationUnitUpdate"
      - type: "object"
        properties:
          id:
            type: "string"
            format: "uuid"
          createdAt:
            type: "string"
            format: "date-time"
          updatedAt:
            type: "string"
            format: "date-time"

  AccommodationNeeds:
    type: "object"
    properties:
      vacancies_needed:
        type: "integer"
      adult_male_count:
        type: "integer"
      adult_female_count:
        type: "integer"
      children_count:
        type: "integer"
      children_ages:
        type: "array"
        items:
          type: "integer"
      have_pets:
        type: "boolean"

  GuestCreate:
    type: "object"
    required:
      - "fullName"
      - "email"
      - "phoneNumber"
    properties:
      fullName:
        type: "string"
        example: "Cecylia Łukaszyk"
      email:
        type: "string"
        format: "email"
      phoneNumber:
        $ref: "#/definitions/PhoneNumber"
      peopleInGroup:
        type: "integer"
      adultMaleCount:
        type: "integer"
      adultFemaleCount:
        type: "integer"
      children:
        type: "array"
        items:
          type: "object"
          properties:
            age:
              type: "integer"
      havePets:
        type: "boolean"
      petsDescription:
        type: "string"
      specialNeeds:
        type: "string"
      financeStatus:
        type: "string"
      howLongToStay:
        type: "string"

  GuestUpdate:
    allOf:
      - $ref: "#/definitions/GuestCreate"
      - type: "object"
        properties:
          status:
            type: "string"
            enum:
              - "created"
              - "verified"
              - "rejected"
          priorityDate:
            type: "string"
            format: "date-time"

  Guest:
    allOf:
      - $ref: "#/definitions/GuestUpdate"
      - type: "object"
        properties:
          id:
            type: "string"
            format: "uuid"
          createdAt:
            type: "string"
            format: "date-time"
          updatedAt:
            type: "string"
            format: "date-time"

  TeamMemberCreate:
    type: "object"
    required:
      - "fullName"
      - "phoneNumber"
    properties:
      fullName:
        type: "string"
        example: "Cecylia Łukaszyk"
      phoneNumber:
        $ref: "#/definitions/PhoneNumber"

  TeamMemberUpdate:
    $ref: "#/definitions/TeamMemberCreate"

  TeamMember:
    allOf:
      - $ref: "#/definitions/TeamMemberUpdate"
      - type: "object"
        properties:
          id:
            type: "string"
            format: "uuid"
    